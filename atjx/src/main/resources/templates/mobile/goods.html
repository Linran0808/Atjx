<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="utf-8"/>
    	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
		<title>商品详情</title>

		<link rel="stylesheet" type="text/css" th:href="@{/css/swiper.min.css}"/>
		<link rel="stylesheet" type="text/css" th:href="@{/css/common.css}"/>
		<link rel="stylesheet" type="text/css" th:href="@{/css/styles.css}"/>
		<link rel="icon" th:href="@{../favicon.ico}" type="image/x-icon" />
		<link rel="shortcut icon" th:href="@{../favicon.ico}" type="image/x-icon" />

	</head>
	<body>
		<div class="container" >
<!--			<div class="listhead">-->
<!--				<img src="../img/headimg.png" />-->
<!--				<span></span>-->
<!--			</div>-->
			<div class="particulars">
				<div class="swiper-container">
					<div class="swiper-wrapper">
							<div class="swiper-slide"  th:each="p:${picList}"><img th:src="${p.pic_url}" /></div>

					</div>
					<!-- Add Pagination -->
					<div class="swiper-pagination"></div>
				</div>
				<div class="listcontent-box">
					<div class="particulars-tit">
<!--						<div class="titiles"></div>-->
						<div class="jianjie" th:text="${item.title}"></div>
					</div>
					<div class="listcontent-price">
						<div class="listcontent-price-left particulars-price-left">
							<span class="prices" th:text="'￥'+${item.price}"></span>&nbsp;
							<s class="yuan" th:text="'原价'+${item.del_price}"></s>&nbsp;
							<span class="fan" th:text="'返'+${item.money}+'元'"></span>
						</div>
						<div class="particulars-price-right" th:text=" '已售'+${item.sales}+'/'+'剩余'+${item.num}"  ></div>
					</div>
				</div>
			</div>
			<div class="particulars-goroup">
				<div class="particularsTie">套餐选择</div>
				<div class="particularsel" >
						<div  th:each="s ,speStat:${item.specification}"  th:text="${s.tname}" th:classappend="${speStat.index==0} ? 'active' : '' " th:attr="data-s_id=${speStat.index}">
						</div>

				</div><br/>
				<hr style="align:center;border:1px dashed #C0C0C0;"/>
			</div><br/>
			<!--	套餐描述		-->
			<div style="text-align: center">
				<label>
<TEXTAREA readonly="readonly" style="resize: none;width: 90%; outline: none;border: none;overflow: hidden;" id="spe_text" rows="5">
</TEXTAREA>
				</label>
			</div>
			<div class="particulars-goroup">
				<div class="particularsTie">商家信息</div>
				<div class="particularsjxx" th:each="a : ${item.address}">


						<div class="particularsjxx-list" >
							<div class="particularsjxx-name" th:text="${a?.shopname}"></div>
							<div class="particularsjxx-jianjie">
								<img src="../img/address.png" alt=""/>
								<div class="address" th:attr="data-add_id=${aStat.index}">
									<p><span   th:text="${a?.addressInfo}"></span><a th:href="'tel:'+${a?.tel}"><img src="../img/tells.png"  alt="电话"/></a></p>
									<p th:text="'营业时间：'+${a?.starttime}"></p>
								</div>
							</div>
						</div>


				</div>
			</div>
			<div class="particulars-goroup">
				<div class="particularsTie">详细信息</div>
				<div class="xiangqing">

					<label for="editor"></label><textarea id="editor" name="sell_Point" th:utext="${item.sell_Point}" style="width: 100%;"></textarea >


				</div>

			</div>

			<div class="particulars-goroup">
				<div class="particularsTie">商家信息</div>
				<div class="particularsjxx" th:each="a : ${item.address}">

					<div class="particularsjxx-list" >
						<div class="particularsjxx-name" th:text="${a?.shopname}"></div>
						<div class="particularsjxx-jianjie">
							<img src="../img/address.png" alt=""/>
							<div class="address" th:attr="data-add_id=${aStat.index}">
								<p><span   th:text="${a?.addressInfo}"></span><a th:href="'tel:'+${a?.tel}"><img src="../img/tells.png"  alt="电话"/></a></p>
								<p th:text="'营业时间：'+${a?.starttime}"></p>
							</div>
						</div>
					</div>


				</div>
			</div>

		</div>

		<div class="hrefbox">
			<div class="sharebox" id="sharebtn">
				<div class="shareboxlist"><p th:text="'会员下单返'+${item.money}+'元'"></p></div>
				<div class="shareboxlist">立即分享</div>
				<img src="../img/jinbi.png" />
				<span class="close">x</span>
			</div>
			<div class="gotops" id="gotops"><img src="../img/tops.png" alt="top"/> </div>
		</div>
		<div class="footer footlist">
			<ul>
				<li>
					<a onclick="window.history.go(-1)"><p>商城首页</p></a>
				</li>
				<li>
					<a href="tel:666666666"><p>咨询客服</p></a>
				</li>
				<li class="active">
					<a id="item_url" ><p>立即购买</p></a>
				</li>
			</ul>
		</div>
		<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>

		<script type="text/javascript">
			/*<![CDATA[*/
			window.jQuery || document.write("<script src='/js/jquery-3.4.1.min.js'>" + "<" + "/script>");
			/*]]>*/
		</script>
		<script type="text/javascript" charset="utf-8" src="/admin/ueditor/ueditor.config.js"></script>
		<script type="text/javascript" charset="utf-8" src="/admin/ueditor/ueditor.all.min.js"> </script>
		<script type="text/javascript" charset="utf-8" src="/admin/ueditor/lang/zh-cn/zh-cn.js" ></script>


		<script th:inline="javascript">
			// var filmDesc = [[${item.sell_Point}]];
			// var htmlStr = $("#editorValue").val();

			$(document).ready(function() {
				var ue = UE.getEditor('editor',
						{
							toolbars: [[]],
							//关闭字数统计  
							wordCount: false,
							//关闭elementPath  
							elementPathEnabled: false,
							//默认的编辑区域高度  
							initialFrameHeight: '100%',

							//更多其他参数，请参考ueditor.config.js中的配置项  
						});
				// ue.addListener('ready',function () {
				// 	ue.execCommand('insertHtml',filmDesc);
				// });
				ue.ready(function () {
					//初始化编辑框内容
					// ue.setContent(htmlStr, false);
					ue.setDisabled();
				});
			});

		</script>
		<script type="text/javascript" charset="utf-8" src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js" ></script>

		<script type="text/javascript" charset="utf-8" th:src="@{/js/swiper.min.js}" ></script>
		<script type="text/javascript" charset="utf-8" th:src="@{/js/particulars.js}" ></script>
<!--		微信JSAPI配置信息-->
		<script type="text/javascript" th:inline="javascript">
			var currurl = decodeURIComponent(location.href.split('#')[0]);
			var jsonObject=[[${itemJson}]];
			$.ajax({//授权
				url : "/getJSAPIConfig",
				dataType : 'json',
				data : {
					'url' : currurl//需要授权的页面
				},
				complete : function(XMLHttpRequest, textStatus) {},
				error : function(XMLHttpRequest, textStatus, errorThrown) {
					alert("发生错误：" + errorThrown);
				},
				success : function(data) {

					// console.log(data);
					var appId = data.appId;
					var nonceStr = data.nonceStr;
					var jsapi_ticket = data.jsapi_ticket;
					//alert(JSON.stringify(res));
					var timestamp = data.timestamp;
					var signature = data.signature;
					wx.config({
						debug: false,
						appId: appId,
						timestamp: timestamp,
						nonceStr: nonceStr,
						signature: signature,
						jsApiList : ['chooseImage', 'uploadImage', 'downloadImage',
									'previewImage', 'openLocation', 'getLocation',
									'scanQRCode', 'checkJsApi', 'onMenuShareTimeline',
									'onMenuShareAppMessage', 'onMenuShareQQ',
									'onMenuShareWeibo', 'onMenuShareQZone','updateAppMessageShareData',
							'updateTimelineShareData','onMenuShareWeibo']
					});
				}
			});//ajaxEnd
			// 分享功能
			var title=jsonObject['address'][0]['shopname'];
			var desc=jsonObject['title'];
			//通过ready接口处理成功验证，加载直接调用的程序放在ready中，这里目前为空
			/*<![CDATA[*/
			wx.ready(function () {

				//配置好需要分享的几个配置，这里只是演示，实际开发中应该是动态的变量

				//调用各个接口并传入配置变量
				//自定义“分享给朋友”及“分享到QQ”按钮的分享内容（1.4.0）
				wx.updateAppMessageShareData({
					title: title, // 分享标题
					desc: desc, // 分享描述
					link: currurl, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
					imgUrl: '', // 分享图标
					success: function () {
						// 设置成功
					}
				});
				//自定义“分享到朋友圈”及“分享到QQ空间”按钮的分享内容（1.4.0）
				wx.updateTimelineShareData({
					title: title, // 分享标题
					link: '', // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
					imgUrl: '', // 分享图标
					success: function () {
						// 设置成功
					}
				});
				wx.onMenuShareWeibo({
					title: title, // 分享标题
					desc: desc, // 分享描述
					link: currurl, // 分享链接
					imgUrl: '', // 分享图标
					success: function () {
						// 用户确认分享后执行的回调函数
					},
					cancel: function () {
						// 用户取消分享后执行的回调函数
					}
				});

			});
			/*]]>*/

		</script>

		<!-- 判断库存为0的情况禁用购买 -->
		<script th:inline="javascript">
			$(document).ready(function(){
				var num=[[${item.num}]];
				var nums=parseInt(num);
				if(nums===0){
					// alert("判断成功");
					$(".active").attr("disabled",true);
					$(".footer footlist li").removeClass();
					$('.footer footlist a').css("pointer-events","none");
					$('.footlist ul li.active').css("background","#808080");
				}
			})
		</script>

<!--		获取套餐价格-->
		<script th:inline="javascript">
			// 获取标识数据
			var jsonObject=[[${itemJson}]];

			$(document).ready(function(){

			// console.log(jsonObject);
			$(function(){
				getattrprice();
				$(".particularsel").each(function(){
					var i=$(this);
					var p=i.find("div");
					p.click(function(){
							$(this).addClass("active").siblings().removeClass("active");
						getattrprice(); //输出价格
					})
				});
				//获取对应属性的价格
				function getattrprice(){
					// var defaultstats=true;
					// var _val='';
					var _resp={
						mktprice:".yuan",
						price:".prices",
						text:"#spe_text"
					};  //输出对应的class
					var item_id = [[${item.id}]];
					var spe = $(".active ").data('s_id');
					var spe_id=jsonObject['specification'][spe]['spe_id'];
						//设置href的值
					/*<![CDATA[*/
					var str="http://atjx.club/mobile/placeOrder?id=" + item_id;
					$("#item_url").attr("href", "https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx7738ac5a31d41ee4&redirect_uri=" +str+ "&response_type=code&scope=snsapi_base&state="+spe_id+"#wechat_redirect");
					/*]]>*/
						_mktprice=jsonObject['specification'][spe]['sdel_price'];
						_price=jsonObject['specification'][spe]['sprice'];
						_text=jsonObject['specification'][spe]['t_describe'];
					//输出价格
					$(_resp.mktprice).text('原价'+_mktprice);  ///其中的math.round为截取小数点位数
					$(_resp.price).text('￥'+_price);
					$(_resp.text).text(_text);
				}
			})
			});
			//实现的是点击class的标签根据已知的经纬度打开内置地图
			$(document).on('click', '.particularsjxx-jianjie', function(){
				var add_id = $(this).data('add_id');
				var name=jsonObject['address'][add_id]['shopname'];
				var addressInfo=jsonObject['address'][add_id]['addressInfo'];
				var latitudeLongitude=jsonObject['address'][add_id]['latitudeLongitude'];
				var tempArr=latitudeLongitude.split(",");
				var longitude=parseFloat(tempArr[0]);
				var latitude=parseFloat(tempArr[1]);
				wx.openLocation({
					latitude: latitude,// 纬度，浮点数，范围为90 ~ -90
					longitude: longitude,// 经度，浮点数，范围为180 ~ -180
					name: name, //要写引号位置名
					address: addressInfo, //要写引号地址详情说明
					scale: 14,// 地图缩放级别,整形值,范围从1~28。默认为最大
					infoUrl: "http://atjx.club/mobile/" //要写引号// 在查看位置界面底部显示的超链接,可点击跳转
				}); //end wx.openLocation
				wx.error(function (res) {
					alert(res.errMsg);
				});
				// 	wx.getLocation({//
				// 		type:'gcj02', // 默认为 wgs84 返回 gps 坐标，gcj02 返回可用于 wx.openLocation 的坐标
				// 		success: function (res) {
				// 			console.log(res.latitude);
				// 			console.log(res.longitude);
				// 			wx.openLocation({
				// 				latitude: latitude,// 纬度，浮点数，范围为90 ~ -90
				// 				longitude: longitude,// 经度，浮点数，范围为180 ~ -180
				// 				name: name, //要写引号位置名
				// 				address: addressInfo, //要写引号地址详情说明
				// 				scale: 14,// 地图缩放级别,整形值,范围从1~28。默认为最大
				// 				infoUrl: "http://atjx.club/mobile/",//要写引号// 在查看位置界面底部显示的超链接,可点击跳转
				// 			});
				// 			wx.error(function (res) {
				// 				alert(res.errMsg);
				// 			});
				// 		}});//end wx.getLocation

			});

			/*<![CDATA[*/

			//分享给朋友
			$(document).on('click', '.sharebox', function(){


			})

			/*]]>*/




		</script>




	</body>


</html>
